---
// src/components/ServicesHome.astro
// Refactored for Cleanliness & Maintainability
import type { BrandConfig } from "../brands";
import { mobileTiresBrand } from "../brands";
import CtaButtonSecondary from "./CtaButtonSecondary.astro";

const { brand = mobileTiresBrand } = Astro.props as { brand?: BrandConfig };

const services = [
  {
    title: "Complete Auto Repair",
    desc: "From routine maintenance to major repairs, our state-of-the-art facility and experienced technicians can handle any make or model. We stand behind our work with a 24-month warranty.",
    tags: ["Engine Repair", "Transmission", "Suspension", "Electrical"],
    icon: "wrench",
    featured: true,
  },
  {
    title: "Brake Service",
    desc: "Pads, rotors, calipers, and brake fluid service. We inspect your entire braking system and ensure your safety on the road.",
    tags: [],
    icon: "stop",
    featured: false,
  },
  {
    title: "Oil Changes",
    desc: "Conventional, synthetic blend, or full synthetic. Quick service with a multi-point inspection included on every visit.",
    tags: [],
    icon: "drop",
    featured: false,
  },
  {
    title: "Full Tire Shop",
    desc: "We carry all major brands: Michelin, Goodyear, Continental, and more. Professional mounting, balancing, and TPMS service included. Competitive prices with expert installation.",
    tags: [],
    icon: "tire",
    featured: false,
    hasCta: true,
  },
];
---

<section
  id="services-home-section"
  class="py-16 lg:py-24 relative overflow-hidden"
>
  <div
    class="absolute -left-20 top-40 w-64 h-64 bg-queens-primary/5 rounded-full blur-3xl pointer-events-none"
  >
  </div>

  <div class="site-canvas">
    {/* HEADER */}
    <div class="text-center max-w-4xl mx-auto mb-16 header-content">
      <div
        class="inline-flex items-center gap-2.5 px-4 py-1.5 rounded-full bg-queens-secondary-ultra-light dark:bg-queens-secondary-darker border border-queens-secondary-light dark:border-queens-secondary-dark text-queens-secondary-darker dark:text-queens-secondary-ultra-light text-[10px] sm:text-xs font-bold uppercase tracking-[0.2em] mb-8"
      >
        <span class="relative flex h-2 w-2">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-queens-primary dark:bg-queens-secondary-ultra-light opacity-75"
          ></span>
          <span
            class="relative inline-flex rounded-full h-2 w-2 bg-queens-primary dark:bg-queens-secondary-ultra-light"
          ></span>
        </span>
        Full Service Auto Shop
      </div>
      <h2 class="display-xl text-queens-secondary dark:text-white mb-8">
        Expert Auto Care. <br />
        <span class="text-queens-primary">Right Here in Algonquin.</span>
      </h2>
      <p class="text-lg text-gray-600 dark:text-gray-400 leading-relaxed">
        Queens Auto Services has been the trusted auto repair shop in Algonquin,
        IL for over a decade. From oil changes to complete engine overhauls, our
        experienced technicians handle it all.
      </p>
    </div>

    {/* BENTO GRID */}
    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 bento-grid"
    >
      {
        services.map((service) => (
          <div
            class:list={[
              "rounded-3xl p-8 shadow-lg transition duration-500 group relative overflow-hidden flex flex-col justify-between",
              service.featured
                ? "md:col-span-2 shadow-2xl hover:shadow-queens-primary/20 border border-gray-800 featured-card-bg"
                : "bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/10 hover:shadow-2xl dark:shadow-queens-primary/5 dark:hover:shadow-queens-primary/20",
              service.hasCta
                ? "md:col-span-2 md:flex-row md:items-end gap-8"
                : "",
            ]}
          >
            <div class={service.hasCta ? "flex-grow" : "relative z-10"}>
              {/* Icon Container */}
              <div
                class:list={[
                  "w-14 h-14 rounded-2xl flex items-center justify-center mb-6 text-queens-primary dark:group-hover:text-white transition duration-500",
                  service.featured
                    ? "bg-white/10 group-hover:scale-110 group-hover:bg-queens-primary group-hover:text-white"
                    : "bg-queens-primary/10 dark:bg-white/10 group-hover:bg-queens-primary group-hover:text-white",
                ]}
              >
                {service.icon === "wrench" && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-7 h-7 group-hover:text-white transition-colors duration-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"
                    />
                  </svg>
                )}
                {service.icon === "stop" && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-7 h-7 group-hover:text-white transition-colors duration-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 019 14.437V9.564z"
                    />
                  </svg>
                )}
                {service.icon === "drop" && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-7 h-7 group-hover:text-white transition-colors duration-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
                    />
                  </svg>
                )}
                {service.icon === "tire" && (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-7 h-7 group-hover:text-white transition-colors duration-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 019 14.437V9.564z"
                    />
                  </svg>
                )}
              </div>

              {/* Text Content */}
              <h3
                class:list={[
                  "font-bold mb-3",
                  service.featured
                    ? "text-2xl text-white"
                    : "text-xl text-queens-secondary dark:text-white mb-2",
                ]}
              >
                {service.title}
              </h3>
              <p
                class:list={[
                  service.featured
                    ? "text-gray-400 mb-6 max-w-md"
                    : "text-gray-500 dark:text-gray-400 text-sm leading-relaxed",
                ]}
              >
                {service.desc}
              </p>

              {/* Featured Tags */}
              {service.featured && (
                <div class="flex flex-wrap gap-2">
                  {service.tags.map((tag) => (
                    <span class="px-3 py-1 bg-gray-800 rounded-lg text-xs font-bold text-gray-300 border border-gray-700">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </div>

            {/* CTA Button for specific cards */}
            {service.hasCta && (
              <div class="flex-shrink-0">
                <CtaButtonSecondary href="/services" text="View All Services" />
              </div>
            )}
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  /* Scoped style for the featured card gradient */
  .featured-card-bg {
    background: linear-gradient(135deg, #0d1b2a 0%, #0d1b2a 60%, #132f4c 100%);
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let servicesHomeCtx: gsap.Context | null = null;

  function initServicesHomeAnimations() {
    // Clean up previous animations
    if (servicesHomeCtx) {
      servicesHomeCtx.revert();
      servicesHomeCtx = null;
    }

    // Use ID for robust selection
    const section = document.getElementById("services-home-section");
    if (!section) return;

    // Create scoped context
    servicesHomeCtx = gsap.context(() => {
      // Header elements
      const headerContainer = section.querySelector(".header-content");
      const badge = headerContainer?.querySelector(".inline-flex");
      const headline = headerContainer?.querySelector("h2");
      const description = headerContainer?.querySelector("p");

      // Bento grid cards
      const cards = section.querySelectorAll(".bento-grid > div");

      // Animate header elements
      const headerElements = [badge, headline, description].filter(Boolean);

      if (headerElements.length > 0) {
        gsap.fromTo(
          headerElements,
          { y: -40, opacity: 0 },
          {
            y: 0,
            opacity: 1,
            stagger: 0.15,
            duration: 0.8,
            ease: "power2.out",
            scrollTrigger: {
              trigger: section,
              start: "top 50%",
              once: true,
            },
          },
        );
      }

      // Animate bento grid cards with stagger
      if (cards.length > 0) {
        gsap.fromTo(
          cards,
          { y: 60, opacity: 0, scale: 0.95 },
          {
            y: 0,
            opacity: 1,
            scale: 1,
            stagger: 0.12,
            duration: 0.8,
            ease: "power2.out",
            scrollTrigger: {
              trigger: section,
              start: "top 40%",
              once: true,
            },
          },
        );
      }
    }, section);
  }

  // Initialize after page load
  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => {
      setTimeout(initServicesHomeAnimations, 200);
    });
  });

  // Cleanup before page swap (Astro View Transitions)
  document.addEventListener("astro:before-swap", () => {
    if (servicesHomeCtx) {
      servicesHomeCtx.revert();
      servicesHomeCtx = null;
    }
  });
</script>
